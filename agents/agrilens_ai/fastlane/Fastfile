# fastlane/Fastfile
default_platform(:android)

platform :android do
  desc "Build Android release"
  lane :build_release do
    gradle(
      task: "bundle",
      build_type: "Release",
      properties: {
        "android.injected.signing.store.file" => ENV["ANDROID_KEYSTORE_PATH"],
        "android.injected.signing.store.password" => ENV["ANDROID_KEYSTORE_PASSWORD"],
        "android.injected.signing.key.alias" => ENV["ANDROID_KEY_ALIAS"],
        "android.injected.signing.key.password" => ENV["ANDROID_KEY_PASSWORD"]
      }
    )
  end

  desc "Submit to Google Play"
  lane :submit_play do
    upload_to_play_store(
      track: 'internal',
      aab: 'android/app/build/outputs/bundle/release/app-release.aab'
    )
  end
end

platform :ios do
  desc "Build iOS release"
  lane :build_release do
    build_app(
      workspace: "AgriLensAI.xcworkspace",
      scheme: "AgriLensAI",
      export_method: "app-store",
      export_options: {
        provisioningProfiles: {
          "com.agrilensai.app" => "App Store Profile"
        }
      }
    )
  end

  desc "Submit to App Store"
  lane :submit_appstore do
    upload_to_app_store(
      api_key: app_store_connect_api_key(
        key_id: ENV["APP_STORE_KEY_ID"],
        issuer_id: ENV["APP_STORE_ISSUER_ID"],
        key_content: ENV["APP_STORE_KEY_CONTENT"]
      )
    )
  end
end